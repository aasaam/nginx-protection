!function mainFunctions(window){window.errorLog=function(o){console.error(o)},window.app=window.angular.module("p",["ngMessages"]).run(["$rootScope","$timeout","$http",function run($rootScope,$timeout,$http){$rootScope.config=window.config,$rootScope.getTimeAccuracy=function(){var o,t;return"Intl"in window&&"RelativeTimeFormat"in Intl?(o=window.config.timeAccuracy,t=new Intl.RelativeTimeFormat(window.config.lang,{style:"short"}),o<5?"":o<=120?t.format(o,"seconds"):o<=3600?t.format(o,"minute"):o<=86400?t.format(o,"hour"):t.format(o,"day")):window.config.timeAccuracy},$rootScope.getCountryName=function(o){if("Intl"in window&&"DisplayNames"in Intl)try{return new Intl.DisplayNames([window.config.lang],{type:"region"}).of(o)}catch(o){}return o},$rootScope.reload=function(o){$timeout(function(){document.querySelector("#app").style.display="none",window.location=window.location},o)},$rootScope.justReload=function(){document.querySelector("#app").style.display="none",window.location=window.location},$rootScope.getCountryFlag=function(o){if(o)try{return o.toUpperCase().replace(/./g,function(o){return String.fromCodePoint(o.charCodeAt(0)+127397)})}catch(o){}return""},$rootScope.mailTo=function(){var o=window.location.hostname;return["mailto:",window.config.supportInfo.email,"?subject=",encodeURIComponent("report protection "+$rootScope.config.challengeType+" on "+o),"&body=",encodeURIComponent(["node: "+window.config.ipData.nodeID,"ip: "+window.config.ipData.ip,"host: "+o,"country: "+window.config.ipData.country,"asn: "+window.config.ipData.asn,"asn name: "+window.config.ipData.asn_org].join("\r\n"))].join("")},$rootScope.urlSupport=function(){var o=window.location.hostname;return window.config.supportInfo.url+"?"+["mode=protection","node="+encodeURIComponent(window.config.ipData.nodeID),"type="+encodeURIComponent($rootScope.config.challengeType),"host="+encodeURIComponent(o),"ip="+encodeURIComponent(window.config.ipData.ip),"country="+encodeURIComponent(window.config.ipData.country),"asn="+encodeURIComponent(window.config.ipData.asn),"asn_org="+encodeURIComponent(window.config.ipData.asn_org)].join("&")},$rootScope.formData={failed:!1,failedReload:!1,jsValue:"",captchaValue:"",totpValue:"",username:"",password:""},$rootScope.challengePATCH=function challengePATCH(callbackFunction,errorCallback){$http({url:window.config.baseURL+"/challenge",method:"PATCH",data:{t:window.config.challengeToken}}).then(function onResponsePath(response){var data=response.data,jsSolved=(window.config.challengeToken=data.t,eval(window.atob(data.js)),window.jsv());delete window.jsv,window.jsv=void 0,$rootScope.formData.jsValue=jsSolved,data.captcha&&1<=data.captcha.length&&($rootScope.captchaImage=data.captcha),callbackFunction()}).catch(function(o){errorCallback?errorCallback(o):window.location.reload()})},$rootScope.challengePOSTCalled=!1,$rootScope.challengePOST=function(o,t){$rootScope.challengePOSTCalled||($rootScope.challengePOSTCalled=!0,$http({url:window.config.baseURL+"/challenge",method:"POST",data:o}).then(function(){window.location.href=$rootScope.config.protectedPath}).catch(function(){t?t():$rootScope.justReload()}))},$rootScope.times={timeAccuracy:Math.abs(window.config.timeAccuracy)<5,progress:0,waitSeconds:parseInt($rootScope.config.waitSeconds,10),timeoutTotal:parseInt($rootScope.config.timeoutSeconds,10),start:Math.round(Date.now()/1e3),timeoutProgress:parseInt($rootScope.config.waitSeconds,10)},$rootScope.times.end=$rootScope.times.start+$rootScope.times.waitSeconds+1,$rootScope.times.total=$rootScope.times.end-$rootScope.times.start,$rootScope.captchaImage="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",$rootScope.timeoutProgressFunc=function(){$timeout(function(){$rootScope.times.timeoutProgress<$rootScope.times.timeoutTotal?($rootScope.times.timeoutProgress+=1,$rootScope.timeoutProgressFunc()):($rootScope.times.timeoutProgress=$rootScope.times.timeoutSeconds,$rootScope.formData.failed=!0,$rootScope.formData.failedReload=!0)},1e3)},$rootScope.progressUpdate=function(t){$timeout(function(){var o=Math.round(Date.now()/1e3)-$rootScope.times.start,o=Math.round(o/$rootScope.times.total*100);o<100?($rootScope.times.progress=Math.floor(o),$rootScope.progressUpdate(t)):($rootScope.times.progress=100,t())},500)},$timeout(function(){document.querySelector("#app").style.display="block"},200)}]),window.app.controller("block",[function(){}]),window.app.controller("js",["$rootScope",function(o){o.progressUpdate(function(){o.challengePATCH(function(){o.challengePOST({t:window.config.challengeToken,j:o.formData.jsValue})})})}]),window.app.controller("captcha",["$scope","$rootScope",function(o,t){t.progressUpdate(function(){t.challengePATCH(function(){document.getElementById("inputCaptcha").focus()})}),t.timeoutProgressFunc(),o.submit=function(){t.challengePOST({t:window.config.challengeToken,j:t.formData.jsValue,c:t.formData.captchaValue},function(){t.formData.failed=!0,t.formData.failedReload=!1,t.reload(3e3)})}}]),window.app.controller("totp",["$scope","$rootScope",function(o,t){t.progressUpdate(function(){t.challengePATCH(function(){document.getElementById("inputTOTP").focus()})}),t.timeoutProgressFunc(),o.submit=function(){t.challengePOST({t:window.config.challengeToken,j:t.formData.jsValue,totp:t.formData.totpValue.toString()},function(){t.formData.failed=!0,t.formData.failedReload=!1,t.reload(3e3)})}}]),window.app.controller("ldap",["$scope","$rootScope",function(o,t){t.progressUpdate(function(){t.challengePATCH(function(){document.getElementById("inputUsername").focus()})}),t.timeoutProgressFunc(),o.submit=function(){t.challengePOST({t:window.config.challengeToken,j:t.formData.jsValue,c:t.formData.captchaValue,lu:t.formData.username,lp:t.formData.password},function(){t.formData.failed=!0,t.formData.failedReload=!1,t.reload(3e3)})}}])}(window);